#!/usr/bin/env python3
import sys, os
p = sys.argv[1] if len(sys.argv)>1 else None
if not p or not os.path.isfile(p) or os.path.getsize(p) == 0:
    sys.exit(0)

repl = {
    '\u2026': '...',  # … → ...
    '\u2014': '-',    # — → -
    '\u2013': '-',    # – → -
    '\u2018': "'", '\u2019': "'",  # ‘ ’ → '
    '\u201c': '"', '\u201d': '"',  # “ ” → "
    '\xa0': ' ',      # NBSP → space
}
changed = False
out_lines = []
with open(p, 'r', encoding='utf-8') as f:
    for line in f:
        s = line
        for k, v in repl.items():
            s = s.replace(k, v)
        if s != line:
            changed = True
        out_lines.append(s)

if changed:
    with open(p, 'w', encoding='utf-8', newline='') as f:
        f.writelines(out_lines)
    print(f"sanitize: normalized unicode punctuation in {p}")
else:
    print("sanitize: no changes")
